# Cox Data Usage
Python web scraper for returning Cox data utilization stats for inclusion in Home Assistant.

## Python Configuration
Update the username and password values with your login credentials.
```
cox_user  = "username"
cox_pass  = "password"
json_file = "path/to/file.json"
```

## Home Assistant Configuration
This integration is broken into five pieces:
* Python script
* Automation that triggers once every hour
* Shell command for the the automation to trigger
* JSON file generated by the python script
* File Sensors to read values from the JSON file

### Python Script
Put this somewhere inside your Home Assistant configuration directory.

### Automation
```
- alias: Query Cox Data Usage
  trigger:
    platform: time
    hours: '/1'
    minutes: 00
    seconds: 00
  action:
    service: shell_command.query_cox_data_usage
```
### Shell Command
```
query_cox_data_usage: 'python /config/python/cox_usage.py'
```

### JSON File
Nothing further to do here. You have already configured where the JSON file will live in the python script.

### Sensor
```
- platform: file
  name: Data Plan
  file_path: /config/json/cox_usage.json
  value_template: >
    {% if value_json is defined %}
      {{ value_json.lpInternetSubscribed }}
    {% else %}
      undefined
    {% endif %}

- platform: file
  name: Data Usage
  file_path: /config/json/cox_usage.json
  value_template: >
    {% if value_json is defined %}
      {% if value_json.dumUsage | int == 0 and value_json.dumLimit | int == 0 and value_json.dumUtilization | int == 0 %}
        stats unavailable
      {% else %}
        {{ value_json.dumUsage | int }} / {{ value_json.dumLimit | int }} GB ({{ value_json.dumUtilization | int }} %)
      {% endif %}
    {% else %}
      undefined
    {% endif %}

- platform: file
  name: Data Resets
  file_path: /config/json/cox_usage.json
  value_template: >
    {% if value_json is defined %}
      {% if value_json.dumDaysLeft is defined %}
        {{ value_json.dumDaysLeft | int }} days
      {% else %}
        unknown
      {% endif %}
    {% else %}
      undefined
    {% endif %}
```

Required dependencies
-----
```
pip install MechanicalSoup
```
